<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="stylesheets/newproject.css">
    <meta charset="UTF-8">
    <title>New Project</title>
</head>
<body>
    <div id="secret">
        <div class="options">
            <div style="top:12px;position:absolute">
                <svg width="160px" height="160px">
                    <g><path class="s" style="fill: rgba(0, 128, 0, 0.5);"  d="M80,80 L80,10 A70,70 1 0,1 147.3,99.2 z"></path></g>
                    <g><path class="s" style="fill:rgba(0, 0, 0, 0.5)" d="M80,80 L147.3,99.2 A70,70 1 0,1 135.9,122.2 z" onclick="notedelete(this)"></path></g>
                    <g><path class="s" style="fill:rgba(255, 0, 0, 0.5)" d="M80,80 L135.9,122.2 A70,70 1 0,1 12.7,99.2 z"></path></g>
                    <g><path class="s" style="fill:rgba(0, 0, 255, 0.5)" d="M80,80 L12.7,99.2 A70,70 1 0,1 80,10 z"></path></g>
                </svg>
                <div class="sections" style="top:40px;left:25px;">
                    <img src="images/krizek.png" >
                    <div class="hidden">
                        <img src="images/krizek.png" onclick="posuvka(this,17)" style="top:-24px;left:-14px">
                        <img src="images/becko.png" onclick="posuvka(this,13)"  style="top:-8px;left:12px">
                        <img src="images/odrazka.png" onclick="posuvka(this,17)" style="top:24px;left:29px">
                        <img src="images/dvakratkrizek.png" onclick="posuvka(this,15,-25)" style="top:3px;left:-20px">
                        <img src="images/dvakratbecko.png" onclick="posuvka(this,11,-25)" style="top:20px;left:-1px">
                    </div>
                </div>
                <div class="sections"style="top:98px;left:45px;">
                    <img src="images/krizekk.png" style="height:15px;">
                    <div class="hidden">
                        <img src="images/krizekk.png" onclick="notedelete(this)" style="height:15px;top:2px;left:5px">
                    </div>
                </div>
                <div class="sections" style="top:100px;left:-25px;">
                    <img src="images/korunka.png">
                    <div class="hidden">
                        <img src="images/prodluzovakICON.png" onclick="znamenko(this,'prodluzovak')" style="top:13px;left:50px;">
                        <img src="images/staccatoICON.png" onclick="znamenko(this,'staccato')" style="top:23px;left:20px;">
                        <img src="images/tenutoICON.png" onclick="znamenko(this,'tenuto')" style="top:17px;left:-10px">
                        <img src="images/korunkaICON.png" onclick="znamenko(this,'korunka')" style="top:-3px;left:-30px">
                        <img src="images/akcentICON.png" onclick="znamenko(this,'akcent')" style="top:-5px;left:25px;">
                        <img src="images/marcatoICON.png" onclick="znamenko(this,'marcato')" style="top:-10px;left:0px;">
                    </div>
                </div>
                <div class="sections" style="top:35px;left:-50px;">
                    <img src="images/trilek.png" >
                    <div class="hidden">
                        <img src="images/trilek.png" onclick="znamenko(this,'trilek')" style="top:30px;left:-25px;">
                        <img src="images/natryl.png" onclick="znamenko(this,'natryl')" style="top:-5px;left:-12px;">
                        <img src="images/mordent.png" onclick="znamenko(this,'mordent')" style="top:-22px;left:15px;">
                        <img src="images/obal1.png" onclick="znamenko(this,'obal1')" style="top:22px;left:0px;">
                        <img src="images/obal2.png" onclick="znamenko(this,'obal2')" style="top:5px;left:15px;">
                    </div>
                </div>
            </div>
        </div>
        <div class="optionsDyn">
            <div>
                <svg width="160px" height="160px">
                    <g><path class="s" style="fill:rgba(0, 0, 0, 0.5)" d="M80,80 L140.62,45 A70,70 1 0,1 140.62,115" onclick="dyndelete(this)"></path></g>
                    <g><path class="s" style="fill:rgba(255, 0, 0, 0.5)" d="M80,80 L140.62,115 A70,70 1 1,1 140.62,45"></path></g>
                </svg>
                <div class="sections"style="top:-26px;left:60px;">
                    <img src="images/krizekk.png" style="height:15px;">
                    <div class="hidden">
                        <img src="images/krizekk.png" onclick="notedelete(this)" style="height:15px;top:2px;left:5px">
                    </div>
                </div>
                <div class="sections" style="top:-30px;left:-50px;">
                    <img src="images/dynamics-mf.png">
                    <div class="hidden">
                        <img src="images/dynamics-fff.png" onclick="" style="top:-45px;left:75px">
                        <img src="images/dynamics-ff.png" onclick="" style="top:-55px;left:40px">
                        <img src="images/dynamics-f.png" onclick="" style="top:-40px;left:10px">
                        <img src="images/dynamics-mf.png" onclick="" style="top:-15px;left:-5px">
                        <img src="images/dynamics-mp.png" onclick="" style="top:15px;left:-5px">
                        <img src="images/dynamics-p.png" onclick="" style="top:40px;left:10px">
                        <img src="images/dynamics-pp.png" onclick="" style="top:55px;left:40px">
                        <img src="images/dynamics-ppp.png" onclick="" style="top:50px;left:75px">
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    <div id="DruhyKolmichLinek" onmouseleave="optThreeHide()">
        <div>
            <img onclick="zmenaTaktu(this.src)" src="/images/taktovaCara.png">
            <img onclick="zmenaTaktu(this.src)" src="/images/taktovaCaradvakrat.png">
            <img onclick="zmenaTaktu(this.src)" src="/images/repeticeL.png">
            <img onclick="zmenaTaktu(this.src)" src="/images/repeticeP.png">
            <img onclick="selectedTakt.remove();optThreeHide()" src="/images/krizekk.png">
        </div>
    </div>
    <div id="mainBar">
        <div class="cell">
            <img src="images/newDocument.png" style="height:30px">
            <div>Nový dokument</div>
        </div>
        <div class="cell KEYS">
            <img src="images/HouslovyKEY.png" onclick="keyChange(0)">
            <img src="images/BasovyKEY.png" onclick="keyChange(1)">
            <img src="images/AltovyKEY.png" onclick="keyChange(2)">
        </div>
        <div class="cell"id="stupniceBar">
            <div style="position:relative">
                <div id="UkazatelDS"  value="UDS">
                    <img src="images/ukazatelS.png" style="height:25px;pointer-events: none" >
                </div>
                <div class="stupniceL">
                </div>
            </div>
        </div>
        <div class="cell" id="dynamics">
            <img src="images/dynamics-fff.png" onclick="targetableDyn(this)">
            <img src="images/dynamics-ff.png"onclick="targetableDyn(this)">
            <img src="images/dynamics-f.png" onclick="targetableDyn(this)">
            <img src="images/dynamics-mf.png" onclick="targetableDyn(this)">
            <img src="images/dynamics-fp.png" onclick="targetableDyn(this)">
            <img src="images/dynamics-ppp.png"onclick="targetableDyn(this)">
            <img src="images/dynamics-pp.png" onclick="targetableDyn(this)">
            <img src="images/dynamics-p.png" onclick="targetableDyn(this)">
            <img src="images/dynamics-mp.png" onclick="targetableDyn(this)">
            <img src="images/dynamics-sfz.png"onclick="targetableDyn(this)">
        </div>
        <div class="cell">
            <img src="images/HouslovyKEY.png">
            <div>Opakování</div>
        </div>

    </div>
    <div id="keysBar">

    </div>
    
    <div id="tools">
        <div class="tool" h="" x="" y="" id="cursor" value="50" style="background:radial-gradient(circle, rgb(255, 255, 255) 0%, rgb(167, 167, 167) 100%)"><img src="images/cursor.png"></div>
        <div class="tool" h="45" x="48" y="-8" posuvka="0" value="13"><img src="images/taktovaCara.png"></div>
        <div class="" h="" x="" y="" value=""></div>
        <div class="" h="" x="" y="" value=""></div>
        <div class="" h="" x="" y="" value=""></div>
        <div class="" h="" x="" y="" value=""></div>
        <div class="tool" h="38" x="50" y="-19" posuvka="-10" value="0"><img src="images/celaNota.png"></div>
        <div class="tool" h="38" x="50" y="-19" posuvka="-10" value="1"><img src="images/pulovaNota.png"></div>
        <div class="tool" h="38" x="50" y="-19" posuvka="-10" value="2"><img src="images/ctvrtovaNota.png"></div>
        <div class="tool" h="38" x="50" y="-19" posuvka="-10" value="3"><img src="images/osminkaNota.png"></div>
        <div class="tool" h="38" x="49" y="-19" posuvka="-10" value="4"><img src="images/sestnatinkaNota.png"></div>
        <div class="tool" h="38" x="49" y="-19" posuvka="-10" value="5"><img src="images/tricetidvatinkaNota.png"></div>
        <div class="tool" h="35" x="58" y="-8" posuvka="0" value="7"><img src="images/celaPomlka.png"></div>
        <div class="tool" h="35" x="58" y="-8" posuvka="0" value="8"><img src="images/pulovaPomlka.png"></div>
        <div class="tool" h="35" x="50" y="-8" posuvka="0" value="9"><img src="images/ctvrtovaPomlka.png"></div>
        <div class="tool" h="35" x="50" y="-8" posuvka="0" value="10"><img src="images/osminkaPomlka.png"></div>
        <div class="tool" h="35" x="50" y="-3" posuvka="0" value="11"><img src="images/sestnatinkovaPomlka.png"></div>
        <div class="tool" h="40" x="58" y="-6" posuvka="0" value="12"><img src="images/tricetidvatinkaPomlka.png"></div>
        
    </div>
    <div id="Tacts">
        <img src="images/Takt22.png">
        <img src="images/Takt24.png">
        <img src="images/Takt28.png">
        <img src="images/Takt32.png">
        <img src="images/Takt34.png">
        <img src="images/Takt38.png">
        <img src="images/Takt44.png">
        <img src="images/Takt48.png">
        <img src="images/Takt64.png">
        <img src="images/Takt68.png">
        <img src="images/TaktC.png">
        <img src="images/TaktAllabreve.png">
    </div>
    <div id="whitePage">
        <div id="Nadpis" contenteditable="true">New Project</div>
        <div id="MusicBY" contenteditable="true">Music by:</div>
        <div id="Arranged"contenteditable="true">Arranged by:</div>
        <div class="row" style="margin-top:200px;">
            <div class="space" TonVzhuruNohama="t" x="4" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="4" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="3" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="3" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="2" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="2" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="1" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="1" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t"><div class="c"></div></div>
            <div class="line" z="1" TonVzhuruNohama="t"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"z="1"prostredniTony="1" TonVzhuruNohama="t"><div class="c"></div></div>
            <div class="line" z="2"prostredniTony="2"TonVzhuruNohama="t" middle="t"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"z="3"prostredniTony="3" TonVzhuruNohama="t"><div class="c"></div></div>
            <div class="line" z="4"prostredniTony="4" TonVzhuruNohama="t" middle="t"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"z="5"prostredniTony="3"><div class="c"></div></div>
            <div class="line" z="6"prostredniTony="2"middle="t"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"z="7"prostredniTony="1"><div class="c"></div></div>
            <div class="line" z="8"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"z="9"><div class="c"></div></div>
            <div class="space dyn"z="10" x="-1" y="2"><div class="c"></div></div>
            <div class="space"z="11" x="-1" y="6"><div class="c"></div></div>
            <div class="space"z="12" x="-2" y="2"><div class="c"></div></div>
            <div class="space"z="13" x="-2" y="6"><div class="c"></div></div>
            <div class="space"z="14" x="-3" y="2"><div class="c"></div></div>
            <div class="space"z="15" x="-3" y="6"><div class="c"></div></div>
            <div class="space"z="16" x="-4" y="2"><div class="c"></div></div>
            <div class="space"z="17" x="-4" y="6"><div class="c"></div></div>
            <div class="naLince">
                <img class="key" src="images/HouslovyKEY.png">
                <div class="preznamenani" id="prvnipreznameni"><img src=""></div>
                <img class="takt" src="images/TaktC.png">
            </div>
            <div class="tempo"><img style="height:20px" src="images/ctvrtovaNota.png"> = <p contenteditable="true">60</p></div>
            <div ></div>
            <img onmouseenter="showThirdOptions(this,'last')" src="images/taktovaCara.png" class="konecniTakt n">
        </div>
        <div class="row" style="margin-top:75px;">
            <div class="space" TonVzhuruNohama="t" x="4" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="4" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="3" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="3" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="2" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="2" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="1" y="7"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t" x="1" y="3"><div class="c"></div></div>
            <div class="space" TonVzhuruNohama="t"><div class="c"></div></div>
            <div class="line" TonVzhuruNohama="t"><div class="c"></div><div class="blackline"></div></div>
            <div class="space" TonVzhuruNohama="t"><div class="c"></div></div>
            <div class="line" TonVzhuruNohama="t"><div class="c"></div><div class="blackline"></div></div>
            <div class="space" TonVzhuruNohama="t"><div class="c"></div></div>
            <div class="line" TonVzhuruNohama="t"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"><div class="c"></div></div>
            <div class="line"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"><div class="c"></div></div>
            <div class="line"><div class="c"></div><div class="blackline"></div></div>
            <div class="space"><div class="c"></div></div>
            <div class="space" x="-1" y="2"><div class="c"></div></div>
            <div class="space" x="-1" y="6"><div class="c"></div></div>
            <div class="space" x="-2" y="2"><div class="c"></div></div>
            <div class="space" x="-2" y="6"><div class="c"></div></div>
            <div class="space" x="-3" y="2"><div class="c"></div></div>
            <div class="space" x="-3" y="6"><div class="c"></div></div>
            <div class="space" x="-4" y="2"><div class="c"></div></div>
            <div class="space" x="-4" y="6"><div class="c"></div></div>
            <div class="naLince">
                <img class="key" src="images/HouslovyKEY.png">
                <div class="preznamenani"><img src=""></div>
            </div>
            <div class="konecniTakt"></div>
        </div>
    </div>
    <!-- Vkládání not -->
    <script>
    const tools=["celaNota","pulovaNota","ctvrtovaNota","osminkaNota","sestnatinkaNota","tricetidvatinkaNota","sedesatictyritinkaNota","celaPomlka","pulovaPomlka","ctvrtovaPomlka","osminkaPomlka","sestnatinkovaPomlka","tricetidvatinkaPomlka","taktovaCara"];
    const page =document.getElementById("whitePage");
    let selectedTool=50;
    let selectedX;
    let selectedY;
    let selectedH;
    let selectedPosuvka;
    let selectedTakt;
    x=document.getElementsByClassName("line");
    y=document.getElementsByClassName("space");
    for(let i=0;i<x.length;i++){
        x[i].onmouseenter=targetable;
        x[i].onmouseout=hideNote;
        x[i].onmousemove=moveWithNote;
        x[i].onmouseup=stopMovingNote;
    }
    for(let i=0;i<y.length;i++){
        y[i].onmouseenter=targetable;
        y[i].onmouseout=hideNote;
        y[i].onmousemove=moveWithNote;
        y[i].onmouseup=stopMovingNote;
    }

    boxes=document.getElementsByClassName("tool");
    for(let i=0;i<boxes.length;i++){
        boxes[i].onclick=selectNote;
    }
    function targetable(){
        if(selectedTool!=50){
            let divimg = document.createElement("div");
            let img = document.createElement("img");
            let containImg =document.createElement("div"); 
            containImg.style.position="relative";
            containImg.classList.add("cImg");
            if(this.getAttribute("TonVzhuruNohama")&&selectedTool>0&&selectedTool<7){
                img.src = "images/"+tools[selectedTool]+"O.png";
                img.style.marginTop="21px";
            }else{
                img.src = "images/"+tools[selectedTool]+".png";
                img.style.marginTop="0px";
            }
            img.style.height = selectedH+"px";
            containImg.style.height=selectedH+"px";
            containImg.style.zIndex=5;
            img.classList.add("n");
            divimg.classList.add("nota");
            divimg.classList.add("t");
            divimg.setAttribute("value",selectedTool);
            divimg.setAttribute("x",selectedX);
            divimg.setAttribute("y",selectedY);
            divimg.setAttribute("h",selectedH);
            divimg.setAttribute("posuvka",selectedPosuvka);
            divimg.style.top = selectedY+"px";
            divimg.style.left = window.event.clientX-page.getBoundingClientRect().left-selectedX+"px";
            containImg.onmousedown=moveNoteManually;
            containImg.onmouseup=stopMovingNote;
            if(selectedTool==13){
                divimg.onmouseenter=showThirdOptions;
            }else{
                divimg.onmouseenter=showOptions;
            }
            containImg.appendChild(img)
            divimg.appendChild(containImg);
            if(this.getAttribute("x")&&selectedTool<7){
                let container = document.createElement("div");
                if(this.getAttribute("x")<0){
                    container.style.bottom=+this.getAttribute("y")+ +selectedPosuvka+ -1+"px";
                    container.style.position="absolute";
                    container.classList.add("helpLine");
                    for(let i=0;i<Math.abs(this.getAttribute("x"));i++){
                        let space= document.createElement("div");
                        let line=document.createElement("div");
                        space.style.width="20px";
                        space.style.height="8px";
                        line.style.height="1px";
                        line.style.backgroundColor="black";
                        space.appendChild(line)
                        container.appendChild(space);
                    }
                    divimg.appendChild(container);
                }else if(this.getAttribute("x")>0){
                    container.style.top=+this.getAttribute("y")+ -selectedPosuvka+ +1+"px";                        
                    container.style.position="absolute";
                    container.classList.add("helpLine");
                    for(let i=0;i<Math.abs(this.getAttribute("x"));i++){
                        let space= document.createElement("div");
                        let line=document.createElement("div");
                        space.style.width="20px";
                        space.style.height="8px";
                        space.style.position="relative";
                        line.style.height="1px";
                        line.style.width="20px";
                        line.style.backgroundColor="black";
                        line.style.bottom="0px";
                        line.style.position="absolute";
                        space.appendChild(line)
                        container.appendChild(space);
                    }
                    divimg.appendChild(container);
                }
            }
            if(selectedTool<7){
                this.getElementsByClassName("c")[0].appendChild(divimg);
            }
            else{
                this.parentElement.getElementsByClassName("line")[2].getElementsByClassName("c")[0].appendChild(divimg);
            }
        }
        else if(selectedDyn){
            let newDyn = document.createElement("img");
            let newDynDiv = document.createElement("div");
            newDynDiv.classList.add("dynDIV");
            newDynDiv.classList.add("tDyn");
            newDynDiv.style.left=window.event.clientX-page.getBoundingClientRect().left-63 +"px";
            newDyn.src=selectedDyn;
            newDynDiv.appendChild(newDyn)
            this.parentElement.getElementsByClassName("dyn")[0].getElementsByClassName("c")[0].appendChild(newDynDiv);
            newDynDiv.onmouseenter=showOptionsForDyn;
        }
        else{
            movingNote = document.getElementsByClassName("t")[0];
            if(movingNote){
                if(movingNote.getAttribute("value")<7){
                    if(this.getAttribute("TonVzhuruNohama")&&movingNote.getAttribute("value")!=0){
                        movingNote.getElementsByClassName("n")[0].src = "images/"+tools[movingNote.getAttribute("value")]+"O.png";
                        movingNote.getElementsByClassName("n")[0].style.marginTop="21px";
                    }else{
                        movingNote.getElementsByClassName("n")[0].src = "images/"+tools[movingNote.getAttribute("value")]+".png";
                        movingNote.getElementsByClassName("n")[0].style.marginTop="0px";
                    }
                    if(movingNote.getElementsByClassName("helpLine")[0]){
                        movingNote.getElementsByClassName("helpLine")[0].remove();
                    }
                    if(movingNote.getElementsByClassName("znamenko")[0]){
                        znakImg = movingNote.getElementsByClassName("znamenko")[0];
                        let j =znakImg.getAttribute("znak");
                        if(j=="akcent"){
                            if(this.getAttribute("prostredniTony")){
                                znakImg.style.top=this.getAttribute("TonVzhuruNohama")?
                                -5*this.getAttribute("prostredniTony")+ +8+"px":
                                +5*this.getAttribute("prostredniTony")+ +32+"px";
                            }else{
                                znakImg.style.top=this.getAttribute("TonVzhuruNohama")?"3px":"27px";
                            }
                        }
                        else if(j=="tenuto"){
                            if(this.getAttribute("middle")){
                                znakImg.style.top=this.getAttribute("TonVzhuruNohama")?"-5px":"22px";
                            }
                            else{
                                znakImg.style.top=this.getAttribute("TonVzhuruNohama")?"-1px":"18px";
                            }
                        }
                        else if(j=="prodluzovak"){
                            znakImg.style.top=this.classList.contains("line")||(this.getAttribute("y")||5)<4?"11px":"15px";
                        }
                        else if(j=="staccato"){
                            if(this.getAttribute("middle")){
                                znakImg.style.top=this.getAttribute("TonVzhuruNohama")?"2px":"30px";
                            }else{
                                znakImg.style.top=this.getAttribute("TonVzhuruNohama")?"6px":"25px";
                            }
                        }
                        else if(j=="korunka"||j=="marcato"||j=="trilek"||j=="natryl"||j=="trilek"||j=="natryl"||j=="mordent"||j=="obal1"||j=="obal2"){
                            znakImg.style.top=this.getAttribute("z")?this.getAttribute("z")*(-4.5)+5+"px":"0.5px";
                        }                        
                    }
                    if(this.getAttribute("x")){
                        let container = document.createElement("div");
                        
                        if(this.getAttribute("x")<0){
                            container.style.bottom=+this.getAttribute("y")+ +movingNote.getAttribute("posuvka")+ -1+"px";
                            container.style.position="absolute";
                            container.classList.add("helpLine");
                            for(let i=0;i<Math.abs(this.getAttribute("x"));i++){
                                let space= document.createElement("div");
                                let line=document.createElement("div");
                                space.style.width="20px";
                                space.style.height="8px";
                                line.style.height="1px";
                                line.style.backgroundColor="black";
                                space.appendChild(line)
                                container.appendChild(space);
                            }
                            movingNote.appendChild(container);
                        }
                        else if(this.getAttribute("x")>0){
                            container.style.top=+this.getAttribute("y")+ -movingNote.getAttribute("posuvka")+ +1+"px";                        
                            container.style.position="absolute";
                            container.classList.add("helpLine");
                            for(let i=0;i<Math.abs(this.getAttribute("x"));i++){
                                let space= document.createElement("div");
                                let line=document.createElement("div");
                                space.style.width="20px";
                                space.style.height="8px";
                                space.style.position="relative";
                                line.style.height="1px";
                                line.style.width="20px";
                                line.style.backgroundColor="black";
                                line.style.bottom="0px";
                                line.style.position="absolute";
                                space.appendChild(line)
                                container.appendChild(space);
                            }
                            movingNote.appendChild(container);
                        }
                    }
                    this.getElementsByClassName("c")[0].appendChild(movingNote);
                }
                else{
                    this.parentElement.getElementsByClassName("line")[2].appendChild(movingNote);
                }
            }
        }
    }
    function hideNote(){
        if(selectedDyn){
            if(document.getElementsByClassName("tDyn")[0]){
                document.getElementsByClassName("tDyn")[0].remove();
            }
        }else if(selectedTool==50){
        }
        else{
            if(document.getElementsByClassName("t")[0]){
                document.getElementsByClassName("t")[0].remove();
            }
        }
    }       
    function moveWithNote(){
        movingDyn=document.getElementsByClassName("tDyn")[0];
        if(movingDyn){
            movingDyn.style.left=window.event.clientX-page.getBoundingClientRect().left-63 +"px";
        }
        movingDiv=document.getElementsByClassName("t")[0];
        if(movingDiv){
            movingDiv.style.left= window.event.clientX-page.getBoundingClientRect().left-movingDiv.getAttribute("x")+"px";
        }
    }
    function selectNote(e,vN){
        vybranaNota=vN||this;
        if(document.getElementsByClassName("t")[0]){
            document.getElementsByClassName("t")[0].remove();
        }
        selectedTool=vybranaNota.getAttribute("value");
        selectedX=vybranaNota.getAttribute("x");
        selectedY=vybranaNota.getAttribute("y");
        selectedH=vybranaNota.getAttribute("h");
        selectedPosuvka=vybranaNota.getAttribute("posuvka");
        dynamicsReset();
        for(i=0;i<boxes.length;i++){
            boxes[i].style.background="white";
        }
        vybranaNota.style.background="radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(167,167,167,1) 100%)";
        
    }
    function moveNoteManually(){
        if(this.parentElement.classList.contains("options")){
            this.parentElement.parentElement.appendChild(this);
            this.parentElement.classList.add("t");
            this.parentElement.style.zIndex=-1;
            optionReset(this.parentElement.getElementsByClassName("options")[0])
        }
    }
    function stopMovingNote(){
        if(document.getElementsByClassName("tDyn")[0]){
            movingDyn=document.getElementsByClassName("tDyn")[0];
            movingDyn.classList.remove("tDyn");
            movingDyn.style.zIndex=2;
        }
        if(document.getElementsByClassName("t")[0]){
            movingNote=document.getElementsByClassName("t")[0].getElementsByClassName("cImg")[0].getElementsByClassName("n")[0];
            if(movingNote.parentElement.parentElement.parentElement.parentElement.getAttribute("TonVzhuruNohama")&&movingNote.parentElement.parentElement.getAttribute("value")<7&&movingNote.parentElement.parentElement.getAttribute("value")!=0){
                movingNote.src="images/"+tools[movingNote.parentElement.parentElement.getAttribute("value")]+"O.png";
                movingNote.style.marginTop="21px";
            }else{
                movingNote.src="images/"+tools[movingNote.parentElement.parentElement.getAttribute("value")]+".png";
                movingNote.style.marginTop="0px";
            }
            movingNote.parentElement.parentElement.classList.remove("t");
            movingNote.parentElement.parentElement.style.zIndex=2;
        }
    }
    // vše týkající se barevného kolečka :D
    function notedelete(e){
        e.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("cImg")[0].remove();
        e.parentElement.parentElement.parentElement.parentElement.parentElement.remove();
        optionReset(e.parentElement.parentElement.parentElement.parentElement);
    }
    function posuvka(ps,top,left){
        if(ps.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("posuvka")[0]){
            if(ps.src==ps.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("posuvka")[0].src){
                ps.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("posuvka")[0].remove();
                return
            }
            ps.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("posuvka")[0].remove();
        }
        znakImg = document.createElement("img");
        znakImg.classList.add("posuvka");
        znakImg.src=ps.src;
        znakImg.style.position="absolute";
        znakImg.style.top=+ps.parentElement.parentElement.parentElement.parentElement.getAttribute("posuvka")+ +top+"px";
        znakImg.style.left=left+"px";
        ps.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("cImg")[0].appendChild(znakImg);
    }
    function znamenko(e,j){
        if(e.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("znamenko")[0]){
            if(e.src.replace("ICON","")==e.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("znamenko")[0].src){
                e.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("znamenko")[0].remove();
                return
            }
            e.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("znamenko")[0].remove();
        }
        znakImg = document.createElement("img");
        znakImg.classList.add("znamenko");
        znakImg.setAttribute("top",e.getAttribute("top"));
        znakImg.src=e.src.replace("ICON","");
        znakImg.style.position="absolute";
        znakImg.setAttribute("znak",j);
        let k=e.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("value");
        let radek=e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;
        if(j=="akcent"){
            if(radek.getAttribute("prostredniTony")){
                znakImg.style.top=radek.getAttribute("TonVzhuruNohama")?
                -5*radek.getAttribute("prostredniTony")+ +8+"px":
                +5*radek.getAttribute("prostredniTony")+ +22+"px";
            }else{
                znakImg.style.top=radek.getAttribute("TonVzhuruNohama")?"3px":"27px";
            }
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"1px":
                k==1||k==2?"-1px":
                k==3||k==4?"2px":
                "1px";
            }
            else{
                znakImg.style.left= 
                k==0?"0px":
                k==1||k==2?"-2px":
                k==3||k==4?"3px":
                "1px";
            }
        }
        else if(j=="tenuto"){
            if(radek.getAttribute("middle")){
                znakImg.style.top=radek.getAttribute("TonVzhuruNohama")?"-5px":"22px";
            }else{
                znakImg.style.top=radek.getAttribute("TonVzhuruNohama")?"-1px":"18px";
            }
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"1px":
                k==1||k==2?"-1px":
                k==3||k==4?"2px":
                "1px";
            }
            else{
                znakImg.style.left= 
                k==0?"0px":
                k==1||k==2?"-2px":
                k==3||k==4?"3px":
                "1px";
            }
        }
        else if(j=="prodluzovak")
        {
            znakImg.style.top=radek.classList.contains("line")||(radek.getAttribute("y")||5)<4?"11px":"15px";
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"5px":
                k==1||k==2?"2px":
                k==3||k==4?"5px":
                "4px";
            }else{
                znakImg.style.left= 
                k==0?"5px":
                k==1||k==2?"1px":
                k==3||k==4?"5px":
                "4px";
            }
        }
        else if(j=="staccato"){
            if(radek.getAttribute("middle")){
                znakImg.style.top=radek.getAttribute("TonVzhuruNohama")?"2px":"30px";
            }else{
                znakImg.style.top=radek.getAttribute("TonVzhuruNohama")?"6px":"25px";
            }
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"-6px":
                k==1||k==2?"-6px":
                k==3||k==4?"-4px":
                "-5px";
            }
            else{
                znakImg.style.left= 
                k==0?"-6px":
                k==1||k==2?"-8px":
                k==3||k==4?"-3px":
                "-4px";
            }
        }
        else if(j=="korunka"){
            znakImg.style.top=radek.getAttribute("z")?radek.getAttribute("z")*(-4.5)+5+"px":"0.5px";
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"0px":
                k==1||k==2?"-1px":
                k==3||k==4?"1px":
                "1px";
            }
            else{
                znakImg.style.left= 
                k==0?"0px":
                k==1||k==2?"-2px":
                k==3||k==4?"60px":
                "1px";
            }
        }
        else if(j=="marcato"){
            znakImg.style.top=radek.getAttribute("z")?radek.getAttribute("z")*(-4.5)+5+"px":"0.5px";
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"2px":
                k==1||k==2?"2px":
                k==3||k==4?"4px":
                "3px";
            }
            else{
                znakImg.style.left= 
                k==0?"2px":
                k==1||k==2?"0px":
                k==3||k==4?"5px":
                "4px";
            }
        }
        else if(j=="trilek"){
            znakImg.style.top=radek.getAttribute("z")?radek.getAttribute("z")*(-4.5)+1+"px":"0.5px";
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"-5px":
                k==1||k==2?"-5px":
                k==3||k==4?"-3px":
                "-4px";
            }
            else{
                znakImg.style.left= 
                k==0?"-5px":
                k==1||k==2?"-5px":
                k==3||k==4?"1px":
                "-1px";
            }
        }
        else if(j=="natryl"||j=="trilek"||j=="natryl"||j=="mordent"||j=="obal1"||j=="obal2"){
            znakImg.style.top=radek.getAttribute("z")?radek.getAttribute("z")*(-4.5)+1+"px":"0.5px";
            if(radek.getAttribute("TonVzhuruNohama")){
                znakImg.style.left= 
                k==0?"-5px":
                k==1||k==2?"-5px":
                k==3||k==4?"-3px":
                "-4px";
            }
            else{
                znakImg.style.left= 
                k==0?"-5px":
                k==1||k==2?"-5px":
                k==3||k==4?"1px":
                "-1px";
            }
        }
        e.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("cImg")[0].appendChild(znakImg);
    }
    const opt = document.getElementsByClassName("options")[0];
    const optDyn =document.getElementsByClassName("optionsDyn")[0];
    function showOptions(){
        if(selectedTool==50&&!(document.getElementsByClassName("t")[0])){
            this.style.zIndex=5;
            if(this.parentElement.parentElement.getAttribute("TonVzhuruNohama")&&this.getAttribute("value")<7&&this.getAttribute("value")!=0){
                this.getElementsByClassName("n")[0].src="images/"+tools[this.getAttribute("value")]+"OrangeO.png";
                this.getElementsByClassName("n")[0].style.marginTop="21px";
            }else{
                this.getElementsByClassName("n")[0].src="images/"+tools[this.getAttribute("value")]+"Orange.png";
                this.getElementsByClassName("n")[0].style.marginTop="0px";
            }
            this.parentElement.parentElement.parentElement.style.zIndex=2;  
            this.appendChild(opt);
            opt.appendChild(this.getElementsByClassName("cImg")[0]);
            opt.onmouseleave=function(){
                if(this.parentElement.parentElement.parentElement.getAttribute("TonVzhuruNohama")&&this.parentElement.getAttribute("value")<7&&this.parentElement.getAttribute("value")!=0){
                    this.parentElement.getElementsByClassName("n")[0].src="images/"+tools[this.parentElement.getAttribute("value")]+"O.png";
                    this.parentElement.getElementsByClassName("n")[0].style.marginTop="21px";
                }else{
                    this.parentElement.getElementsByClassName("n")[0].src="images/"+tools[this.parentElement.getAttribute("value")]+".png";
                    this.getElementsByClassName("n")[0].style.marginTop="0px";
                }
                this.parentElement.appendChild(this.parentElement.getElementsByClassName("cImg")[0]);
                this.parentElement.style.zIndex=2;
                this.parentElement.parentElement.parentElement.parentElement.style.zIndex=0;  
                optionReset(this);
            }            
        }
    }
    function showOptionsForDyn(){
        if(selectedTool==50&&!(document.getElementsByClassName("tDyn")[0])){
            this.parentElement.style.zIndex=2;
            this.style.zIndex=5;
            this.appendChild(optDyn);
            optDyn.onmouseleave=function(){
                optionDynReset(this);
            }
        }
    }
    const pies=document.getElementsByClassName("options")[0].getElementsByClassName("sections");
    const s = document.getElementsByClassName("s");
    for(let i=0;i<pies.length;i++){
        s[i].onmouseenter=function(){
            for(let x=0;x<pies.length;x++){
                s[x].style.transform="scale(1)";
                pies[x].getElementsByTagName("img")[0].style.display="block"
                pies[x].getElementsByClassName("hidden")[0].style.display="none";
            }
            s[i].style.transform="scale(1.1)";
            pies[i].getElementsByTagName("img")[0].style.display="none";
            pies[i].getElementsByClassName("hidden")[0].style.display="block";
        }
    }
    //pomocné funkce
    function optionReset(e){
        document.getElementById("secret").appendChild(e);
        for(let x=0;x<pies.length;x++){
            s[x].style.transform="scale(1)";
            pies[x].getElementsByTagName("img")[0].style.display="block"
            pies[x].getElementsByClassName("hidden")[0].style.display="none";
        }
    }
    const piesdyn=document.getElementsByClassName("optionsDyn")[0].getElementsByClassName("sections");
    const sdyn = document.getElementsByClassName("optionsDyn")[0].getElementsByClassName("s");
    for(let i=0;i<pies.length;i++){
        sdyn[i].onmouseenter=function(){
            console.log("it has happend")
            for(let x=0;x<piesdyn.length;x++){
                sdyn[x].style.transform="scale(1)";
                piesdyn[x].getElementsByTagName("img")[0].style.display="block"
                piesdyn[x].getElementsByClassName("hidden")[0].style.display="none";
            }
            sdyn[i].style.transform="scale(1.1)";
            piesdyn[i].getElementsByTagName("img")[0].style.display="none";
            piesdyn[i].getElementsByClassName("hidden")[0].style.display="block";
        }
    }
    function optionDynReset(e){
        document.getElementById("secret").appendChild(e);
        for(let x=0;x<pies.length;x++){
            sdyn[x].style.transform="scale(1)";
            piesdyn[x].getElementsByTagName("img")[0].style.display="block"
            piesdyn[x].getElementsByClassName("hidden")[0].style.display="none";
        }
    }
    const thirdOPT=document.getElementById("DruhyKolmichLinek");
    function showThirdOptions(m,j){
        if(j=="last"){
            e=m;
        }else{
            e=this;
        }
        
        if(selectedTool==50){
            if(e.classList.contains("n")){
                selectedTakt=e.parentElement.parentElement;
            }else{
                selectedTakt=e;
            }
            thirdOPT.style.display="block";
            thirdOPT.style.top=+e.getBoundingClientRect().top-20+"px";
            thirdOPT.style.left=+e.getBoundingClientRect().left-40+"px";
        }
    }
    function optThreeHide(){
        thirdOPT.style.display="none";
    }
    function zmenaTaktu(e){
        selectedTakt.getElementsByClassName("n")[0].src=e;
    }
    function dynamicsReset(){
        selectedDyn="";
        for(let i=0;i<dynamic.length;i++){
            dynamic[i].style.backgroundColor="";
        }
        tDyn=document.getElementsByClassName("tDyn")[0];
        if(tDyn){
            tDyn.remove()
        }
        
    }
    </script>
    <!-- Dragging system -->
    <script>
        dragElement(document.getElementById("tools"));

        function dragElement(elmnt) {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            document.getElementById("tools").onmousedown = dragMouseDown;


            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // set the element's new position:
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                /* stop moving when mouse button is released:*/
                document.onmouseup = defaultSettingForDocMouseUp;
                document.onmousemove = null;
                cursor="";

            }
        }
    </script>
    <!-- On Key pressed -->
    <script>
        document.addEventListener("keydown",function(e){
            if(e.key==="Escape"){
                div=document.getElementsByClassName("t")[0];
                if(selectedTool<7){
                    if(div){
                        div.remove();
                    }
                }
                else if(selectedTool==50){
                }
                else{
                    if(div){
                        div.remove();
                    }
                }
                for(i=0;i<boxes.length;i++){
                    boxes[i].style.background="white";
                }
                document.getElementById("cursor").style.background="radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(167,167,167,1) 100%)";
                selectedTool="50";
                selectedX="";
                selectedY="";
                selectedH="";
            }
            if(e.key==="p"){
                debugger;
            };
            if(e.key==="q"){  
                if(document.getElementsByClassName("t")[0]){
                    document.getElementsByClassName("t")[0].remove();
                }
                selectNote(null,document.getElementsByClassName("tool")[0]);
            }
            if(e.key==="w"){
                selectNote(null,document.getElementsByClassName("tool")[1]);
            }
            if(e.key==="e"){
                selectNote(null,document.getElementsByClassName("tool")[2]);
            }
            if(e.key==="r"){
                selectNote(null,document.getElementsByClassName("tool")[3]);
            }
            if(e.key==="t"){
                selectNote(null,document.getElementsByClassName("tool")[4]);
            }
            if(e.key==="z"){
                selectNote(null,document.getElementsByClassName("tool")[5]);
            }
            if(e.key==="u"){
                selectNote(null,document.getElementsByClassName("tool")[6]);
            }
            if(e.key==="s"){
                selectNote(null,document.getElementsByClassName("tool")[7]);
            }
            if(e.key==="d"){
                selectNote(null,document.getElementsByClassName("tool")[8]);
            }
            if(e.key==="f"){
                selectNote(null,document.getElementsByClassName("tool")[9]);
            }
            if(e.key==="g"){
                selectNote(null,document.getElementsByClassName("tool")[10]);
            }
            if(e.key==="h"){
                selectNote(null,document.getElementsByClassName("tool")[11]);
            }
            if(e.key==="j"){
                selectNote(null,document.getElementsByClassName("tool")[12]);
            }
            dynamicsReset();
        })
        document.onclick=function(){
            if(CanClickAnyWhere==1){
                nabidkaTakty.style.display="none";
            }
            else{
                CanClickAnyWhere-=1;
            }

        }
        document.onmouseup=defaultSettingForDocMouseUp;
        function defaultSettingForDocMouseUp(){
            if(cursor){
                cursor="";
            }
        }
    </script>   
    <!-- Takty -->
    <script>

        x=document.getElementsByClassName("takt");
        const nabidkaTakty =document.getElementById("Tacts");
        let n;
        CanClickAnyWhere=2;
        function showTacts(){
            nabidkaTakty.style.display="grid";
            nabidkaTakty.style.top=+this.getBoundingClientRect().top+50+"px";
            nabidkaTakty.style.left=this.getBoundingClientRect().left+"px";
            CanClickAnyWhere=2;
            n=this
        }
        for(let i=0;i<x.length;i++){
            x[0].onclick=showTacts;
        }
        y=nabidkaTakty.getElementsByTagName("img");
        for(let i=0;i<y.length;i++){
            y[i].onclick=function(){
                n.src=y[i].src;
            }
        }
    </script>
    <!-- Main Menu -->
    <script>
        const keysSRC=["images/HouslovyKEY.png","images/BasovyKEY.png","images/AltovyKEY.png"];
        function keyChange(value){
            let keys=document.getElementsByClassName("key");
            for(let i=0;i<keys.length;i++){
                keys[i].src=keysSRC[value];
                keys[i].style.height="70px";
            }
        }

        stupniceDurove=["Ces","Ges","Des","As","Es","B","F","C","G","D","A","E","H","Fis","Cis"]
        let cursor="";
        document.getElementById("UkazatelDS").onmousedown=function(){cursor=this.getAttribute("value")};
        for(let i=0;i<15;i++){
            let sDiv=document.createElement("div");
            let text= document.createElement("div");
            text.innerText=stupniceDurove[i];
            text.classList.add("textstupnice")
            sDiv.appendChild(text);
            sDiv.classList.add("stupnice");
            sDiv.style.left=400/14*i+"px";
            document.getElementsByClassName("stupniceL")[0].appendChild(sDiv);

        }

        document.getElementById("stupniceBar").onmousemove=function(){
            if(cursor=="UDS"){
                for(let i=0;i<15;i++){
                    let h=window.event.clientX-document.getElementById("stupniceBar").getBoundingClientRect().left+ -35;

                    if(h>Math.round(400/14*i)-5&&h<Math.round(400/14*i)+5){
                        document.getElementById("UkazatelDS").style.left=Math.round(400/14*i)+"px";
                        preznamenani=document.getElementsByClassName("preznamenani");
                        for(let x=0;x<preznamenani.length;x++){
                            preznamenani[x].getElementsByTagName("img")[0].src="images/stupnice"+i+".png";
                            if(i==7){
                                preznamenani[x].getElementsByTagName("img")[0].src="";
                            }
                        }
                    }
                }
            }
        }
        //dynamika 
        const dynamic= document.getElementById("dynamics").children;
        let selectedDyn;
        console.log(dynamic);
        function targetableDyn(dyn){
            selectNote(null,document.getElementsByClassName("tool")[0]);
            for(let i=0;i<dynamic.length;i++){
                dynamic[i].style.backgroundColor="";
            }
            dyn.style.backgroundColor="rgb(173, 173, 173)";
            selectedDyn=dyn.src;
        }
    </script>
</body>
</html>